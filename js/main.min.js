"use strict";

// RESPONSIVE

// Breakpoints
var breakpoints = {
  xl: 1200,
  lg: 992,
  md: 768,
  sm: 576,
  xsm: 375,
};

// Media quires
var MQ = {
  wWidth: 0,
  isXL: false,
  isLG: false,
  isMD: false,
  isSM: false,
  isXSM: false,
  updateState: function updateState() {
    this.wWidth = $(window).width();
    for (var key in breakpoints) {
      this["is" + key.toUpperCase()] = this.wWidth <= breakpoints[key];
    }
  },
};
MQ.updateState();
$(document).ready(function () {
  var checkboxInput = $(".choose-form__label-content input[type=checkbox]");
  function favoriteStarsSwitcher() {
    checkboxInput.each(function (index, item) {
      var isChecked = $(item).prop("checked");
      if (isChecked) {
        $(item).parent().addClass("label-active");
        $(item).parent().find(".favourite-btn").addClass("fav-active");
      } else {
        $(item).parent().removeClass("label-active");
        $(item).parent().find(".favourite-btn").removeClass("fav-active");
      }
    });
  }
  favoriteStarsSwitcher();
  checkboxInput.on("change", favoriteStarsSwitcher);
});
$(window).on("load", function () {});
$(window).on("resize", function () {
  MQ.updateState();
});

// COMMON FUNCTIONS

// Popup opener
$(".js-popup").on("click", function (event) {
  event.preventDefault();
  var popupID = $(this).attr("href");
  mfpPopup(popupID);
});

// Mobile menu toggle
$(".js-menu").on("click", function () {
  $(this).toggleClass("is-active");
  $(".menu").toggleClass("is-opened");
});

// Phone input mask
// $('input[type="tel"]').inputmask({
//   mask: '+7 (999) 999-99-99',
//   showMaskOnHover: false,
// })

// E-mail Ajax Send
// $('form').on('submit', function (e) {
//   e.preventDefault()

//   let form = $(this)
//   let formData = {}
//   formData.data = {}

//   // Serialize
//   form.find('input, textarea').each(function () {
//     let name = $(this).attr('name')
//     let title = $(this).attr('data-name')
//     let value = $(this).val()

//     formData.data[name] = {
//       title: title,
//       value: value,
//     }

//     if (name === 'subject') {
//       formData.subject = {
//         value: value,
//       }
//       delete formData.data.subject
//     }
//   })

//   $.ajax({
//     type: 'POST',
//     url: 'mail/mail.php',
//     dataType: 'json',
//     data: formData,
//   }).done(function (data) {
//     if (data.status === 'success') {
//       if (form.closest('.mfp-wrap').hasClass('mfp-ready')) {
//         form.find('.form-result').addClass('form-result--success')
//       } else {
//         mfpPopup('#success')
//       }

//       setTimeout(function () {
//         if (form.closest('.mfp-wrap').hasClass('mfp-ready')) {
//           form.find('.form-result').removeClass('form-result--success')
//         }
//         $.magnificPopup.close()
//         form.trigger('reset')
//       }, 3000)
//     } else {
//       alert('Ajax result: ' + data.status)
//     }
//   })
//   return false
// })

var mfpPopup = function mfpPopup(popupID, source) {
  // https://dimsemenov.com/plugins/magnific-popup/
  $.magnificPopup.open({
    items: {
      src: popupID,
    },
    type: "inline",
    fixedContentPos: false,
    fixedBgPos: true,
    overflowY: "auto",
    closeBtnInside: true,
    preloader: false,
    midClick: true,
    removalDelay: 300,
    closeMarkup: '<button type="button" class="mfp-close">&times</button>',
    mainClass: "mfp-fade-zoom",
    // callbacks: {
    // 	open: function() {
    // 		$('.source').val(source)
    // 	}
    // }
  });
};

// Sliders begin

var topSlider = new Swiper(".top-slider", {
  slidesPerView: 10,
  slidesPerGroup: 3,
  simulateTouch: true,
  spaceBetween: 15,
  speed: 500,
  navigation: {
    prevEl: ".top-slider-prev",
    nextEl: ".top-slider-next",
  },
  breakpoints: {
    1200: {
      slidesPerView: 10,
    },
    992: {
      slidesPerView: 8,
    },
    768: {
      slidesPerView: 6,
    },
    576: {
      slidesPerView: 4,
    },
    0: {
      slidesPerView: 3,
    },
  },
});
var cloningSliderElements = $(".meets__track-item").clone();
new Swiper(".meets__track", {
  loop: true,
  slidesPerView: 5,
  loopedSlides: 5,
  spaceBetween: 30,
  wrapperClass: "meets__track-wrapper",
  slideClass: "meets__track-item",
  speed: 2050,
  simulateTouch: false,
  freeMode: {
    enabled: true,
  },
  autoplay: {
    delay: 0,
    disableOnInteraction: false,
  },
  on: {
    beforeInit: function beforeInit() {
      $(".meets__track-wrapper").append(cloningSliderElements);
    },
  },
  breakpoints: {
    1440: {
      slidesPerView: 5,
    },
    576: {
      slidesPerView: 4,
    },
    0: {
      slidesPerView: 3,
    },
  },
});
new Swiper(".slider-meets", {
  loop: true,
  slidesPerView: 2,
  spaceBetween: 30,
  keyboard: {
    enabled: true,
    onlyOnViewport: true,
  },
  breakpoints: {
    576: {
      slidesPerView: 2,
    },
    0: {
      slidesPerView: 1,
    },
  },
});
new Swiper(".shop-slider", {
  spaceBetween: 32,
  slidesPerView: 3,
  keyboard: {
    enabled: true,
  },
  breakpoints: {
    992: {
      slidesPerView: 3,
    },
    576: {
      slidesPerView: 2,
    },
    0: {
      slidesPerView: 1,
      centeredSlides: true,
    },
  },
});
new Swiper(".photo-slider", {
  slidesPerView: 1,
  spaceBetween: 10,
  navigation: {
    nextEl: ".photo-next",
    prevEl: ".photo-prev",
  },
});

// multiSlider function begin

var multiSlider = function multiSlider() {
  var styleSliders = document.querySelectorAll(".style__item");
  styleSliders.forEach(function (item) {
    new Swiper(item.querySelector(".style-slider"), {
      navigation: {
        nextEl: item.querySelector(".style-button-next"),
        prevEl: item.querySelector(".style-button-prev"),
      },
    });
  });
};
multiSlider();

// multiSlider function end

// Sliders end

// MultiSelect function begin

var multiSelect = function multiSelect() {
  var selects = document.querySelectorAll(".js-choice");
  selects.forEach(function (item) {
    new Choices(item, {
      searchEnabled: false,
      resetScrollPosition: false,
      itemSelectText: "",
      allowHTML: false,
      classNames: {
        flippedState: "",
      },
    });
  });
};
multiSelect();

// MultiSelect function end

var showPassword = function showPassword() {
  var showBtn = $(".show-btn");
  var passInput = $(".password-input");
  showBtn.on("click", function (e) {
    e.preventDefault();
    $(this).toggleClass("active");
    if ($(this).parent().find(passInput).attr("type") === "password") {
      $(this).parent().find(passInput).attr("type", "text");
    } else {
      $(this).parent().find(passInput).attr("type", "password");
    }
  });
};
showPassword();
var filterBtnParent = $(".js-filters");
filterBtnParent.each(function (index, item) {
  var filterBtn = $(item).find(".filter-btn");
  filterBtn.on("click", function () {
    filterBtn.removeClass("active");
    $(this).addClass("active");
  });
});
var titleInput = $("#titleInput");
var proposeTextarea = $(".propose-form__textarea");
var authorInput = $("#authorInput");
var result = $(".input-result");
var proposeBtn = $(".propose-form-submit");
var inputLimit = function inputLimit(input, limit) {
  input
    .parent()
    .find(result)
    .text("0 / ".concat(limit, " \u0417\u043D\u0430\u043A\u043E\u0432"));
  input.on("input", function () {
    var textLength = $(this).val().length;
    $(this)
      .parent()
      .find(result)
      .text(
        ""
          .concat(textLength, " / ")
          .concat(limit, " \u0417\u043D\u0430\u043A\u043E\u0432")
      );
    if (textLength > limit) {
      $(this).css("border-color", "red");
      $(this).parent().find(result).css("color", "red");
      // proposeBtn.prop('disabled', true)
    } else {
      $(this).css("border-color", "#D8D8D8");
      $(this).parent().find(result).css("color", "#000");
      // proposeBtn.prop('disabled', false)
    }
  });
};

inputLimit(titleInput, 100);
inputLimit(proposeTextarea, 1000);
inputLimit(authorInput, 500);
var formImagesQ = $(".photo-upload__input");
var formPreviewsQ = $(".photo-upload");
formImagesQ.each(function (i, item) {
  var currentPreviewQ = formPreviewsQ[i];
  $(item).on("change", function (e) {
    if (!e.target.files[0]) {
      return;
    }
    var fileUrlQ = URL.createObjectURL(e.target.files[0]);
    setFileElementQ(fileUrlQ, currentPreviewQ);
  });
});
function setFileElementQ(url, element) {
  $(element).prepend(
    '\n  <div class="photo-upload__preview">\n    <img src="'.concat(
      url,
      '" alt="">\n  </div>\n  '
    )
  );
}
var videoInput = $(".video-upload__input");
var videoContainer = $(".video-upload");
videoInput.on("change", function (e) {
  var videoUrl = URL.createObjectURL(this.files[0]);
  setVideoFile(videoUrl, videoContainer);
});
function setVideoFile(url, element) {
  $(element).prepend(
    '\n  <video class="video-upload__preview" width="100%" height="100%" controls>\n    <source src="'.concat(
      url,
      '" />\n  </video>\n  '
    )
  );
}
var sportThemeBtn = $("#sportTheme"),
  movieThemeBtn = $("#movieTheme"),
  musicThemeBtn = $("#musicTheme"),
  fashionThemeBtn = $("#fashionTheme"),
  basketballThemeBtn = $("#basketballTheme"),
  cricketThemeBtn = $("#cricketTheme"),
  volleyballThemeBtn = $("#volleyballTheme");
function themeSwitcher(element, classNames) {
  element.on("click", function (e) {
    e.preventDefault();
    $(this).addClass("active");
    $(this).parent().find(".theme-btn").not(this).removeClass("active");
    $(".wrapper").removeClass().addClass(classNames);
  });
}
themeSwitcher(sportThemeBtn, "wrapper sport-bg");
themeSwitcher(movieThemeBtn, "wrapper movie-bg");
themeSwitcher(musicThemeBtn, "wrapper music-bg");
themeSwitcher(fashionThemeBtn, "wrapper fashion-bg");
themeSwitcher(basketballThemeBtn, "wrapper basketball-bg");
themeSwitcher(cricketThemeBtn, "wrapper cricket-bg");
themeSwitcher(volleyballThemeBtn, "wrapper volleyball-bg");
var personsItem = $(".persons-likes__item-box");
function personsStatusSwitcher() {
  personsItem.on("click", function (e) {
    $(this).toggleClass("active");
  });
}
personsStatusSwitcher();
// document.addEventListener("DOMContentLoaded", function () {
//   let menuTitle = document.querySelector(".header__menu-title");
//   let menuList = document.querySelector(".header__menu-list");

//   menuTitle.addEventListener("click", function () {
//     if (menuList.classList.contains("active")) {
//       menuList.style.height = "0";
//       menuList.classList.remove("active");
//     } else {
//       menuList.style.height = "auto";
//       var computedHeight = getComputedStyle(menuList).height;
//       menuList.style.height = "0";
//       menuList.classList.add("active");

//       // Задержка для корректной анимации
//       setTimeout(function () {
//         menuList.style.height = computedHeight;
//       }, 0);
//     }
//   });
// });
document.addEventListener("DOMContentLoaded", function () {
  var stars = document.querySelectorAll(".star");
  stars.forEach(function (star) {
    star.addEventListener("click", function () {
      var value = this.getAttribute("data-value");
      console.log("Selected value: ".concat(value));
    });
  });
});
